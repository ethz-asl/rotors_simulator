<?xml version="1.0"?>
<!--
  Copyright 2018 Nearthalb Inc.
-->
<robot xmlns:xacro="http://ros.org/wiki/xacro">
  <xacro:property name="pi" value="3.14159265359" />
  
  <xacro:macro name="gimbal_macro" params="namespace parent_link *origin">

    <link name="${namespace}/gimbal_roll_link">
      <inertial>
        <mass value="0.1" />  
        <inertia ixx="0.01" ixy="0.0" ixz="0.0" iyy="0.01" iyz="0.0" izz="0.01" />
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 ${pi/2} 0" />
        <geometry>
          <cylinder radius="0.02" length="0.02" />
        </geometry>        
      </visual>
      
    </link>    
    <joint name="${namespace}/gimbal_roll_joint" type="continuous">
      <xacro:insert_block name="origin" />
      <parent link="${parent_link}" />
      <child link="${namespace}/gimbal_roll_link" />
      <axis xyz="1 0 0" />
    </joint>
  
    <link name="${namespace}/gimbal_pitch_link">
      <inertial>
        <mass value="0.1" />  
        <inertia ixx="0.01" ixy="0.0" ixz="0.0" iyy="0.01" iyz="0.0" izz="0.01" />
      </inertial>
      <visual>      
        <origin xyz="0 0 0" rpy="${pi/2} 0 0" />
        <geometry>
          <cylinder radius="0.02" length="0.02" />
        </geometry>        
      </visual>
    </link>    
    <joint name="${namespace}/gimbal_pitch_joint" type="continuous">
      <origin xyz="0.1 0.1 0" rpy="0 0 0" />
      <parent link="${namespace}/gimbal_roll_link" />
      <child link="${namespace}/gimbal_pitch_link" />
      <axis xyz="0 1 0" />
    </joint>

    <link name="${namespace}/gimbal_plate_link">
      <inertial>
        <mass value="0.1" />  
        <inertia ixx="0.01" ixy="0.0" ixz="0.0" iyy="0.01" iyz="0.0" izz="0.01" />
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <box size ="0.05 0.1 0.005" />
        </geometry>        
      </visual>
    </link>    
    <joint name="${namespace}/gimbal_plate_joint" type="fixed">
      <origin xyz="0 -0.1 -0.02" rpy="0 0 0" />
      <parent link="${namespace}/gimbal_pitch_link" />
      <child link="${namespace}/gimbal_plate_link" />
    </joint>
    
    <gazebo>
      <plugin name="front_gimbal_plugin" filename="libgazebo_front_gimbal_plugin.so">   
      <robotNamespace>${namespace}</robotNamespace>  
      </plugin>
    </gazebo>

    <gazebo reference="${namespace}/gimbal_roll_link">
      <material>Gazebo/Black</material>
    </gazebo>
    <gazebo reference="${namespace}/gimbal_pitch_link">
      <material>Gazebo/Black</material>
    </gazebo>
    <gazebo reference="${namespace}/gimbal_plate_link">
      <material>Gazebo/Black</material>
    </gazebo>

  </xacro:macro>
</robot>
